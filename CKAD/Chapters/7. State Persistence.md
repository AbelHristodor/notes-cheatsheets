---
created: 2024-01-11T15:04
updated: 2024-02-19T11:47
Done: true
tags:
  - storage
  - volumes
category: Configuration
---
# Volumes
Volumes allow persistence to be added to pods. Without volumes all data would be deleted when the pod gets deleted or restarted.
e.g.
```
...pod definition
spec:
	containers:
	...
	volumes:
	- name: data-volume
	  hostPath:
		  path: /data
		  type: Directory
```
Using the **hostPath** is not recommended since that would be stored on the node itself, so it is better to store data using external services such aws ebs etc..

## Persistent Volume
In order to not create volumes per each pod (e.g. write volume definition on each pod config), we would like to have a large storage pool from which each pod can allocate some space to store its data.

A **Persistent Volume** is a cluster-wide pool of storage volumes to be used by users deploying applications on the cluster.
A user can request a certain amount of space by using **Persistent Volume Claims (PVC)**, after the request gets processed the PVC gets *binded* to the PV.

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
	name: pv-vol1
spec:
	accessModes:
		- ReadOnlyOnce
	capacity:
		storage: 1Gi
	hostPath: // Volume type e.g. awsebs etc..
		path: /tmp/data // not recommended in prod env
```

**Available access modes:**
- *ReadOnlyMany*
- *ReadWriteOnce*
- *ReadWriteMany*

### Persistent Volume Claims
```yaml
apiVersion: v1
kind: PersistentVolumeClaim
spec:
	accessModes:
		- ReadWriteOnce
	resources:
		requests:
			storage: 500Mi
```

Use `k get pvc` to retrieve info about the pvc.
If you delete a pvc by default the pv does not get deleted. It can be set by the `persistentVolumeReclaimPolicy` key to be `Recice` or `Retain` to prevent deletion (Default).

## Storage Classes
In order to not manually create the disk each time we need storage for a pv, we can use `storage classes` to automatically provision storage.

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
	name: my-sc
provisioner: kubernetes.io/gce-pod
```

and then define the `storageClassName` in the pvc. Not that you won't need to manually create a PV since the storageclass will be doing that automatically. 
There are also other parameters and configuration that you can pass to the sc but they may depend on the platform used to host your cluster.

## Stateful Sets
